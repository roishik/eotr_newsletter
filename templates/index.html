<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobileye Newsletter Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
        textarea, input { width: 100%; padding: 8px; margin-top: 5px; }
    </style>
    <script>
        function generateSection(sectionKey) {
            const urls = document.getElementById(`${sectionKey}_urls`).value;
            const notes = document.getElementById(`${sectionKey}_notes`).value;
            const prompt = document.getElementById(`${sectionKey}_prompt`).value;

            fetch("/generate_section", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams({ section_key: sectionKey, article_urls: urls, notes: notes, section_prompt: prompt })
            })
            .then(response => response.json())
            .then(data => document.getElementById(`${sectionKey}_output`).innerHTML = data.output)
            .catch(error => console.error("Error:", error));
        }

        function createNewsletter() {
            fetch("/create_newsletter", { method: "POST" })
            .then(response => response.json())
            .then(data => {
                document.getElementById("final_output").innerHTML = data.content;
                alert(`Newsletter saved as ${data.filename}`);
            })
            .catch(error => console.error("Error:", error));
        }
    </script>
</head>
<body>
    <h1>Mobileye Newsletter Generator</h1>

    <div class="section">
        <h2>Overall Prompt</h2>
        <textarea id="overall_prompt" placeholder="Overall Prompt">{{ defaultPrompts["overall"] }}</textarea>
    </div>

    <div class="section">
        <h2>Windshield View</h2>
        <input type="text" id="windshield_urls" placeholder=";;-separated URLs (e.g., URL1, URL2)">
        <textarea id="windshield_notes" placeholder="Notes"></textarea>
        <textarea id="windshield_prompt" placeholder="Section Prompt">{{ defaultPrompts["windshield"] }}</textarea>
        <button onclick="generateSection('windshield')">Generate Section</button>
        <div id="windshield_output"></div>
    </div>

    <div class="section">
        <h2>Rearview Mirror (Multiple Stories)</h2>
        {% for i in range(1,6) %}
        <div>
            <input type="text" id="rearview_urls_{{ i }}" placeholder="Story {{ i }} URLs">
            <textarea id="rearview_notes_{{ i }}" placeholder="Notes"></textarea>
            <textarea id="rearview_prompt_{{ i }}" placeholder="Section Prompt">{{ defaultPrompts["rearview"] }}</textarea>
            <button onclick="generateSection('rearview')">Generate Story {{ i }}</button>
            <div id="rearview_output_{{ i }}"></div>
        </div>
        {% endfor %}
    </div>

    <div class="section">
        <h2>Dashboard Data</h2>
        <input type="text" id="dashboard_urls" placeholder="Comma-separated URLs (e.g., URL1, URL2)">
        <textarea id="dashboard_notes" placeholder="Notes"></textarea>
        <textarea id="dashboard_prompt" placeholder="Section Prompt">{{ defaultPrompts["dashboard"] }}</textarea>
        <button onclick="generateSection('dashboard')">Generate Section</button>
        <div id="dashboard_output"></div>
    </div>

    <div class="section">
        <h2>The Next Lane</h2>
        <input type="text" id="nextlane_urls" placeholder="Comma-separated URLs (e.g., URL1, URL2)">
        <textarea id="nextlane_notes" placeholder="Notes"></textarea>
        <textarea id="nextlane_prompt" placeholder="Section Prompt">{{ defaultPrompts["nextlane"] }}</textarea>
        <button onclick="generateSection('nextlane')">Generate Section</button>
        <div id="nextlane_output"></div>
    </div>

    <h2>Finalize Newsletter</h2>
    <button onclick="createNewsletter()">Create Newsletter</button>
    <div id="final_output"></div>
</body>
</html>
